{"version":3,"sources":["../src/node.js"],"names":[],"mappings":";;;;;;;;;;;kBAawB,Y;;AAbxB;;AACA;;;;;;;;;;AAEA,MAAM,mBAAmB;AACrB,KAAC,4BAAO,KAAR,GAAgB,OADK;AAErB,KAAC,4BAAO,KAAR,GAAgB,OAFK;AAGrB,KAAC,4BAAO,IAAR,GAAe,MAHM;AAIrB,KAAC,4BAAO,OAAR,GAAkB,SAJG;AAKrB,KAAC,4BAAO,KAAR,GAAgB,OALK;AAMrB,KAAC,4BAAO,KAAR,GAAgB,OANK;AAOrB,KAAC,4BAAO,SAAR,GAAoB;AAPC,CAAzB;;;;;EAUe,SAAS,YAAT,CAAsB,QAAtB,EAAgC;AAC3C,UAAM,cAAc,kBAAgB,QAAhB,CAApB;;AAEA,W;;;;aAAO,SAAS,KAAT,CAAe,CAAf,QAA8C;AAAA,gBAA1B,KAA0B,QAA1B,KAA0B;AAAA,gBAAnB,QAAmB,QAAnB,QAAmB;AAAA,gBAAT,KAAS,QAAT,KAAS;;AACjD,gBAAI,QAAQ,YAAY,SAAS,KAAjC;;AAEA,gBAAI,CAAC,KAAL,EAAY;AACR;AACH;;AAED,kBAAM,yBAAiB,QAAjB,IAA2B,YAA3B,GAAN;AACA,mBAAO,UAAU,KAAjB;;AAEA,gBAAI,MAAM,aAAV,EAAyB;;AAErB,0BAAU,WAAV,GAAwB,MAAM,UAAN,CAAiB,OAAjB,EAAxB;AACA,wBAAQ,MAAM,aAAd;AACH;;AAED,wBAAY,YAAZ,CACI,KADJ,EAEI;AACI,uBAAO,iBAAiB,KAAjB,KAA2B,OADtC;AAEI,uBAAO;AAFX,aAFJ;AAOH;AAvBD;AAwBH","file":"node.js","sourcesContent":["import { Client as RavenClient } from 'raven';\nimport levels from 'nightingale-levels';\n\nconst mapToSentryLevel = {\n    [levels.TRACE]: 'debug',\n    [levels.DEBUG]: 'debug',\n    [levels.INFO]: 'info',\n    [levels.WARNING]: 'warning',\n    [levels.ERROR]: 'error',\n    [levels.FATAL]: 'fatal',\n    [levels.EMERGENCY]: 'fatal',\n};\n\nexport default function sentryOutput(ravenUrl) {\n    const ravenClient = new RavenClient(ravenUrl);\n\n    return function write(_, { level, metadata, extra }) {\n        let error = metadata && metadata.error;\n\n        if (!error) {\n            return;\n        }\n\n        const extraData = { ...metadata, extra };\n        delete extraData.error;\n\n        if (error.originalError) {\n            // error-processor\n            extraData.parsedStack = error.stackTrace.toArray();\n            error = error.originalError;\n        }\n\n        ravenClient.captureError(\n            error,\n            {\n                level: mapToSentryLevel[level] || 'error',\n                extra: extraData,\n            }\n        );\n    };\n}\n"]}