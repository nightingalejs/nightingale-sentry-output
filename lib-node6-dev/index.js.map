{"version":3,"sources":["../src/index.js"],"names":["sentryOutput","mapToSentryLevel","TRACE","DEBUG","INFO","WARNING","ERROR","FATAL","EMERGENCY","ravenUrl","ravenClient","write","_","level","metadata","extra","error","extraData","originalError","parsedStack","stackTrace","toArray","captureError"],"mappings":";;;;;;;;kBAawBA,Y;;AAbxB;;AACA;;;;;;AAEA,MAAMC,mBAAmB;AACvB,GAAC,4BAAOC,KAAR,GAAgB,OADO;AAEvB,GAAC,4BAAOC,KAAR,GAAgB,OAFO;AAGvB,GAAC,4BAAOC,IAAR,GAAe,MAHQ;AAIvB,GAAC,4BAAOC,OAAR,GAAkB,SAJK;AAKvB,GAAC,4BAAOC,KAAR,GAAgB,OALO;AAMvB,GAAC,4BAAOC,KAAR,GAAgB,OANO;AAOvB,GAAC,4BAAOC,SAAR,GAAoB;AAPG,CAAzB;;AAUe,SAASR,YAAT,CAAsBS,QAAtB,EAAgC;AAC7C,QAAMC,cAAc,kBAAgBD,QAAhB,CAApB;;AAEA,SAAO,SAASE,KAAT,CAAeC,CAAf,QAA8C;AAAA,QAA1BC,KAA0B,QAA1BA,KAA0B;AAAA,QAAnBC,QAAmB,QAAnBA,QAAmB;AAAA,QAATC,KAAS,QAATA,KAAS;;AACnD,QAAIC,QAAQF,YAAYA,SAASE,KAAjC;;AAEA,QAAI,CAACA,KAAL,EAAY;AACV;AACD;;AAED,UAAMC,yBAAiBH,QAAjB,IAA2BC,KAA3B,GAAN;AACA,WAAOE,UAAUD,KAAjB;;AAEA,QAAIA,MAAME,aAAV,EAAyB;AACvB;AACAD,gBAAUE,WAAV,GAAwBH,MAAMI,UAAN,CAAiBC,OAAjB,EAAxB;AACAL,cAAQA,MAAME,aAAd;AACD;;AAEDR,gBAAYY,YAAZ,CACEN,KADF,EAEE;AACEH,aAAOZ,iBAAiBY,KAAjB,KAA2B,OADpC;AAEEE,aAAOE;AAFT,KAFF;AAOD,GAvBD;AAwBD","file":"index.js","sourcesContent":["import { Client as RavenClient } from 'raven';\nimport levels from 'nightingale-levels';\n\nconst mapToSentryLevel = {\n  [levels.TRACE]: 'debug',\n  [levels.DEBUG]: 'debug',\n  [levels.INFO]: 'info',\n  [levels.WARNING]: 'warning',\n  [levels.ERROR]: 'error',\n  [levels.FATAL]: 'fatal',\n  [levels.EMERGENCY]: 'fatal',\n};\n\nexport default function sentryOutput(ravenUrl) {\n  const ravenClient = new RavenClient(ravenUrl);\n\n  return function write(_, { level, metadata, extra }) {\n    let error = metadata && metadata.error;\n\n    if (!error) {\n      return;\n    }\n\n    const extraData = { ...metadata, extra };\n    delete extraData.error;\n\n    if (error.originalError) {\n      // error-processor\n      extraData.parsedStack = error.stackTrace.toArray();\n      error = error.originalError;\n    }\n\n    ravenClient.captureError(\n      error,\n      {\n        level: mapToSentryLevel[level] || 'error',\n        extra: extraData,\n      },\n    );\n  };\n}\n"]}